"use strict";(self.webpackChunkalan_turing_ppi=self.webpackChunkalan_turing_ppi||[]).push([[342],{1342:function(e,t,n){n.r(t),n.d(t,{Calibrate:function(){return I},default:function(){return z}});var a=n(4165),i=n(5861),r=n(885),o=n(2791),l=n(6633),s=n(9164),c=n(1889),u=n(890),h=n(8870),d=n(9373),m=n(8461),p=n(3239),f=n(8333),b='This step allows you to calibrate the model parameters. These parameters are specified in the columns: "alpha", "alpha_prime", and "beta" from the indicators data template. If you have never calibrated PPI, you must run this step to obtain the parameter values. Once you have performed this step, you can download the parameter values and copy them into the indicators template so that, in the future, you do not need to perform the calibration again (the skip button should be enabled if the parameter values are provided in the indicators dataset). If your indicators data change, you should perform this step again, as the parameters need to be re-calibrated to capture such change.',g="You can determine how good should the calibration quality be. The higher the quality, the more time it takes to calibrate the model. If the calibration is taking too long, you can reset it and choose a lower quality. For quick tests, it is advisable to use a quality value around 0.3. Once you are sure about the type of exercise and the data that you plan to use, you can calibrate the model at a higher quality. A quality of 1 is theoretically the highest, but it is unachievable in practical terms due to the stochasticity of the model.",x=n(429),j=n(3457),y=n(2982),v=n(4616),Z=n(3949);function k(e,t,n,a,i,r,o,l,s,c,u,h,d,m,p,f,b){var g=arguments.length>17&&void 0!==arguments[17]&&arguments[17],x=[];if(void 0===p||null==p)for(var j in Array.from({length:b}))x.push((0,Z.X)(e,t,n,a,i,r,null,o,l,null,null,s,c,u=null,h,null,f,g));var v=Array(e.length).fill([]),k=Array(e.length).fill([]);x[0][0].tolist();x.forEach((function(e){e[0].tolist().forEach((function(e,t){v[t]=[].concat((0,y.Z)(v[t]),[e[e.length-1]])})),e[5].tolist().forEach((function(e,t){k[t]=[].concat((0,y.Z)(k[t]),[nj.mean(e)])}))}));var w=v.map((function(e){return nj.mean(e)})),S=k.map((function(e){return nj.mean(e)})),_=Object.keys(d).map((function(e){return d[e]-w[e]})),C=Object.keys(m).map((function(e){return m[e]-S[e]})),P=[];return P=(P=P.concat(_)).concat(C),[nj.array(P),x[0][0].shape[1]]}var w=n(4045),S=n(4802),_=n.n(S),C=n(4312),P=n(8579),O=n(184),M={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:500,width:"100%",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24},A=(0,j.Z)(l.ZP)({height:8,"& .MuiSlider-track":{border:"none"},"& .MuiSlider-thumb":{height:24,width:24,backgroundColor:"#fff",border:"2px solid currentColor","&:focus, &:hover, &.Mui-active, &.Mui-SliderfocusVisible":{boxShadow:"inherit"},"&:before":{display:"none"}},"& .MuiSlider-valueLabel":{backgroundColor:"#f0f0f0"},"& .MuiSlider-valueLabelLabel":{color:"black"},"& .MuiTypography-body1":{fontWeight:700,fontSize:"22px",lineHeight:"30px"}}),I=function(e){var t=e.nextStep,n=e.simulationState,l=e.indicatorsResult,j=e.budgetResults,Z=e.setCalibration,S=e.calibration,I=e.budget,z=e.networkResults,q=o.useState(C.kA),F=(0,r.Z)(q,2),D=F[0],E=F[1],L=o.useState(),T=(0,r.Z)(L,2),W=T[0],R=T[1],B=o.useState(!1),J=(0,r.Z)(B,2),V=J[0],Y=J[1],G=o.useState(!1),H=(0,r.Z)(G,2),N=H[0],U=H[1],X=o.useState(!1),K=(0,r.Z)(X,2),Q=K[0],$=K[1],ee=o.useState(!1),te=(0,r.Z)(ee,2),ne=te[0],ae=te[1],ie=function(){return ae(!1)},re=function(){return new Promise((function(e){var t=l.ID,n=l.I0,a=l.IF,i=l.success_rates,o=l.R,s=l.qm,c=l.rl,u=null!==z?z.A:null,h=I||null,d=null;j&&j.Bs&&(h=j.Bs,d=j.B_dict);var m=C.qz,p=C.Je,f=C.MO,b=C.UF,g=C.j4,x=C.k_,Z=function(e,t,n,a,i,o,l,s,c,u){var h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:50,d=arguments.length>11?arguments[11]:void 0,m=arguments.length>12?arguments[12]:void 0,p=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0,b=arguments.length>15?arguments[15]:void 0,g=arguments.length>16?arguments[16]:void 0,x=arguments.length>17?arguments[17]:void 0;nj.config.printThreshold=4,a=(a=a.map((function(e){return e>=1?.95:e}))).map((function(e){return e<=0?.05:e})),(0,v.hu)(m<1,"the threshold must be lower than 1"),(0,v.hu)(t.length==n.length,"I0 and IF must have the same size");for(var j=t.length,Z=nj.ones(3*j).multiply(.5).tolist(),w=0,S=nj.zeros(j),_=nj.zeros(j),C=[],P=[],O=[],M=[],A=[],I=[],z=function(){w+=1,P=Z.slice(0,j),O=Z.slice(j,2*j),M=Z.slice(2*j);var e=k(t,P,O,M,i,o,l,s,c,u,null,h,n,a,d,g,x,!0),m=(0,r.Z)(e,2),y=m[0],v=m[1];A=y.tolist().slice(0,j),I=y.tolist().slice(j),C.push(v);for(var z=Object.keys(A).map((function(e){return Math.abs(A[e])})),q=Object.keys(n).map((function(e){return n[e]-t[e]})),F=Object.keys(q).map((function(e){return Math.abs(q[e])})),D=Object.keys(z).map((function(e){return z[e]/F[e]})),E=Object.keys(D).map((function(e){return Math.abs(D[e])})),L=Object.keys(I).map((function(e){return Math.abs(I[e])})),T=Object.keys(a).map((function(e){return L[e]/a[e]})),W=Object.keys(T).map((function(e){return Math.abs(T[e])})),R=0;R<j;R++)A[R]<0?n[R]!=t[R]&&(Z[R]=Z[R]*nj.clip(1-E[R],.25,.99).get(0),Z[R+j]=Z[R+j]*nj.clip(1+E[R],1.01,1.5).get(0)):A[R]>0&&n[R]!==t[R]&&(Z[R]=Z[R]*nj.clip(1+E[R],1.01,1.5).get(0),Z[R+j]=Z[R+j]*nj.clip(1-E[R],.25,.99).get(0)),I[R]>0?Z[R+2*j]=Z[R+2*j]*nj.clip(1+W[R],1.01,1.5).get(0):I[R]<0&&(Z[R+2*j]=Z[R+2*j]*nj.clip(1-W[R],.25,.99).get(0));if(S=nj.array(Object.values(D).map((function(e){return 1-e}))),_=nj.array(Object.values(W).map((function(e){return 1-e}))),w>=f&&(x+=b),p){var B=[];B=(B=B.concat(S.tolist())).concat(_.tolist()),console.log("Iteration: ".concat(w,". Worst goodness of fit: ").concat(nj.mean(B)))}};nj.mean(S)<m||nj.mean(_)<m;)z();var q=nj.zeros(1);return q.set(0,["indicator_label","alpha","alpha_prime","beta","error_alpha","error_beta","GoF_alpha","GoF_beta"]),(0,y.Z)(Array(j).keys()).map((function(t){return q.set(t+1,[e[t],P[t],O[t],M[t],A[t],I[t],S.get(t),_.get(t)])})),q}(t,n,a,i,u,o,s,c,h,d,C.Dt,m,D,x,p,f,b,g);e(Z)})).then((function(e){Z(e),Y(!1)}))};return o.useEffect((function(){var e;R(.5<(e=D)&&e<=.7?"Medium":.7<e&&e<=.9?"High":e>.9?"Very high":"Low")}),[D]),o.useEffect((function(){!0===V&&$(!0)}),[V]),o.useEffect((function(){var e=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:re();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();!0===Q&&e()}),[Q]),o.useEffect((function(){U(function(e){return!e.calibrated&&!(!e.alpha.some((function(e){return"number"!==typeof e}))&&!e.alpha.length)&&!(!e.alpha_prime.some((function(e){return"number"!==typeof e}))&&!e.alpha_prime.length)&&!(!e.beta.some((function(e){return"number"!==typeof e}))&&!e.beta.length)}(l))}),[]),(0,O.jsx)(s.Z,{maxWidth:"xl",sx:{paddingY:function(e){return[e.spacing(4),e.spacing(4),e.spacing(8)]}},children:(0,O.jsxs)(c.ZP,{container:!0,rowSpacing:4,columnSpacing:8,columnns:{xs:4,sm:8,md:12,lg:12},children:[(0,O.jsx)(c.ZP,{item:!0,xs:12,md:5,children:(0,O.jsx)(P.J,{})}),(0,O.jsx)(c.ZP,{item:!0,xs:12,md:7,children:(0,O.jsx)(x.Y,{selected:n})}),(0,O.jsxs)(c.ZP,{item:!0,xs:12,md:5,children:[(0,O.jsx)(u.Z,{variant:"h1",children:"Calibration"}),(0,O.jsx)(u.Z,{mt:4,variant:"body1",children:b})]}),(0,O.jsxs)(c.ZP,{item:!0,xs:12,md:7,children:[(0,O.jsx)(u.Z,{variant:"h5",children:"Calibration quality"}),(0,O.jsx)(u.Z,{mt:4,children:g}),(0,O.jsxs)(c.ZP,{container:!0,spacing:4,columnns:{xs:4,sm:8,md:12,lg:12},mt:4,children:[(0,O.jsx)(c.ZP,{item:!0,xs:12,md:8,children:(0,O.jsxs)(h.Z,{pl:2,pr:2,mt:1,children:[!V&&!S&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(A,{defaultValue:.7,value:D,valueLabelDisplay:"on",onChange:function(e){return E(e.target.value)},disabled:V,min:.05,max:.95,step:.05,valueLabelFormat:function(e){return(0,O.jsx)(u.Z,{children:e})}}),(0,O.jsxs)(u.Z,{children:["Accuracy: ",W]})]}),V&&(0,O.jsx)(u.Z,{children:"Calibrating..."}),!V&&S&&S.selection&&S.selection.data&&(0,O.jsx)(d.Z,{variant:"outlined",onClick:function(){return function(){var e="CalibratedData-".concat((new Date).toLocaleDateString().replaceAll("/","-")),t=w.P6.aoa_to_sheet(S.selection.data),n=w.P6.book_new();w.P6.book_append_sheet(n,t,"SheetJS");var a=w.cW(n,{bookType:"xlsx",type:"array"}),i=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});_().saveAs(i,e+".xlsx")}()},children:"Download calibrated data"})]})}),(0,O.jsxs)(c.ZP,{item:!0,xs:12,md:4,children:[!V&&!S&&(0,O.jsx)(d.Z,{variant:"contained",size:"large",onClick:function(){return ae(!0)},disabled:0===D||1===D,children:"Start calibration"}),!S&&(0,O.jsx)(m.Z,{open:ne,onClose:ie,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,O.jsx)(h.Z,{sx:M,children:(0,O.jsxs)(h.Z,{p:4,children:[(0,O.jsx)(u.Z,{id:"modal-modal-title",variant:"h5",component:"h2",mb:2,children:"Information before you start"}),(0,O.jsx)(u.Z,{id:"modal-modal-description",mb:2,children:"Depending on your calibration level, it may use much of your computer's resources and other tasks may be affected while the calibration runs. We suggest not attempting to perform other tasks while it is running."}),(0,O.jsx)(u.Z,{mb:4,children:"Are you sure you want to run the calibration now?"}),!V&&(0,O.jsxs)(c.ZP,{container:!0,spacing:4,columnns:{xs:4,sm:8,md:12,lg:12},children:[(0,O.jsx)(c.ZP,{item:!0,xs:12,lg:6,children:(0,O.jsx)(d.Z,{variant:"contained",size:"large",onClick:function(){return Y(!0)},disabled:0===D||1===D||V,children:"Start calibration"})}),(0,O.jsx)(c.ZP,{item:!0,xs:12,lg:6,children:(0,O.jsx)(d.Z,{variant:"outlined",size:"large",onClick:ie,disabled:0===D||1===D||V,children:"Not right now"})})]}),V&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p.Z,{color:"success"}),(0,O.jsx)(u.Z,{children:"Calibrating..."})]})]})})})]})]}),(0,O.jsxs)(h.Z,{mt:4,textAlign:"right",children:[(0,O.jsx)(d.Z,{variant:"outlined",size:"large",onClick:function(){return t()},disabled:!N||V,sx:{marginRight:function(e){return e.spacing(4)}},children:"Skip this step"}),(0,O.jsx)(d.Z,{variant:"contained",size:"large",onClick:function(){return t()},disabled:null===S,endIcon:(0,O.jsx)(f.Z,{}),children:"Next"})]})]})]})})},z=I}}]);
//# sourceMappingURL=342.2c134dc9.chunk.js.map